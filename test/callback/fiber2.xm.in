system = Module("system"
callback = Module("callback"
print = system.out.write_line
assert = @(x) if !x: throw Throwable("Assertion failed."

fm = Fiber.current(

Derived = Class(callback.Client) :: @
	$on_message = @(message)
		print("fc: " + message
		fm("Good bye."

server = callback.Server(
server.add(Derived(

fc = Fiber(@(x) server.post(x

print("fm: " + fc("Hello."
